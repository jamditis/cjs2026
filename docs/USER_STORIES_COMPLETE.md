# CJS2026 Atomized User Stories & Validation Report

> **Generated:** 2026-01-10
> **Total Stories:** 84 across 6 domains
> **Validation Status:** Complete with issues identified

---

## Executive Summary

This document contains **84 atomized user stories** for the CJS2026 Collaborative Journalism Summit website, each with clear acceptance criteria and identified edge cases. The stories were generated by analyzing the actual codebase implementation and validated against the source code.

### Critical Issues Discovered

| Priority | Issue | Location | Impact |
|----------|-------|----------|--------|
| ðŸ”´ CRITICAL | Eventbrite webhook signature verification broken | functions/index.js:1337 | Webhooks will fail signature check |
| ðŸ”´ CRITICAL | Missing Firestore rules for eventbrite collections | firestore.rules | Blocks admin sync status UI |
| ðŸŸ  HIGH | Date mismatch (June 8-9 vs June 15-16) | 10+ files | Users see wrong dates |
| ðŸŸ  HIGH | No redirect to original URL after login | Login.jsx | Poor UX on protected routes |
| ðŸŸ¡ MEDIUM | Profile `createdAt` overwritten on completion | AuthContext.jsx:389 | Incorrect timestamps |
| ðŸŸ¡ MEDIUM | Social links not validated for profanity | Dashboard.jsx | Content policy gap |

---

## Table of Contents

1. [Authentication Domain (12 stories)](#1-authentication-domain)
2. [Profile Management Domain (15 stories)](#2-profile-management-domain)
3. [Schedule & Sessions Domain (12 stories)](#3-schedule--sessions-domain)
4. [Bookmarking Domain (15 stories)](#4-bookmarking-domain)
5. [Admin Panel Domain (18 stories)](#5-admin-panel-domain)
6. [Eventbrite Integration Domain (12 stories)](#6-eventbrite-integration-domain)
7. [Validation Learnings](#7-validation-learnings)
8. [Recommended Fixes](#8-recommended-fixes)

---

## 1. Authentication Domain

**Stories:** US-AUTH-001 through US-AUTH-012
**Files:** AuthContext.jsx, Login.jsx, AuthCallback.jsx, ProtectedRoute.jsx

### Story List

| ID | Title | Status |
|----|-------|--------|
| US-AUTH-001 | Google OAuth Sign-in (Happy Path) | âœ… Validated |
| US-AUTH-002 | Google OAuth Popup Blocked | âœ… Validated |
| US-AUTH-003 | Google OAuth Popup Cancelled | âœ… Validated |
| US-AUTH-004 | Magic Link Request | âœ… Validated |
| US-AUTH-005 | Magic Link Cooldown Enforcement | âœ… Validated |
| US-AUTH-006 | Magic Link Callback Completion | âœ… Validated |
| US-AUTH-007 | Magic Link Expired/Invalid | âœ… Validated |
| US-AUTH-008 | Profile Creation on First Auth | âš ï¸ Issue #2 |
| US-AUTH-009 | Session Persistence | âœ… Validated |
| US-AUTH-010 | Sign Out | âœ… Validated |
| US-AUTH-011 | Bootstrap Admin Detection | âœ… Validated |
| US-AUTH-012 | Protected Route Access Control | âš ï¸ Issue #4 |

### Key Constants

```javascript
COOLDOWN_SECONDS = 60              // Magic link cooldown
ADMIN_EMAILS = [                   // Bootstrap admins
  "jamditis@gmail.com",
  "murrayst@montclair.edu",
  "etiennec@montclair.edu"
]
```

### Issues Found

1. **Dead code for auth pending flag** - `cjs2026_auth_pending` checked but never set
2. **createdAt overwritten** - Profile completion overwrites original timestamp
3. **Weak UX on different device** - Uses `window.prompt()` for email entry
4. **No redirect after login** - Always goes to /dashboard, not original URL
5. **Email validation missing** - `completeProfileSetup()` accepts optional email without validation

---

## 2. Profile Management Domain

**Stories:** US-PROFILE-001 through US-PROFILE-015
**Files:** Dashboard.jsx, ProfileSetupModal.jsx, profanityFilter.js

### Story List

| ID | Title | Status |
|----|-------|--------|
| US-PROFILE-001 | First-time Profile Setup Modal | âœ… Validated |
| US-PROFILE-002 | Skip Profile Setup | âœ… Validated |
| US-PROFILE-003 | 6-Step Profile Wizard | âœ… Validated |
| US-PROFILE-004 | Profile Photo Upload | âš ï¸ Inconsistent |
| US-PROFILE-005 | Photo Validation (Size/Type) | âœ… Validated |
| US-PROFILE-006 | Organization & Job Title | âœ… Validated |
| US-PROFILE-007 | Attendance History Selection | âœ… Validated |
| US-PROFILE-008 | Auto-Generate Attendance Badges | âœ… Validated |
| US-PROFILE-009 | Select Predefined Badges | âœ… Validated |
| US-PROFILE-010 | Personality-Hire Allows 2 Roles | âœ… Validated |
| US-PROFILE-011 | Create Custom Badges | âš ï¸ Issue |
| US-PROFILE-012 | Edit Profile in Dashboard | âœ… Validated |
| US-PROFILE-013 | Social Link Prefix Stripping | âœ… Validated |
| US-PROFILE-014 | Profile Completion Percentage | âœ… Validated |
| US-PROFILE-015 | Profanity Validation | âš ï¸ Gap |

### Key Constants

```javascript
// Photo upload
PHOTO_CONFIG = {
  maxSizeBytes: 2 * 1024 * 1024,  // 2MB
  maxDimension: 400,               // px
  quality: 0.85                    // JPEG
}

// Profile completion weights
displayName: 30%
organization: 20%
jobTitle: 15%
photoURL: 20%
badges: 15%
```

### Issues Found

1. **Date mismatch** - Dashboard shows June 8-9 instead of June 15-16
2. **Social links no profanity check** - Fields skip validation
3. **Custom badge lowercase** - Stores labels in lowercase, changes user input
4. **Photo upload inconsistent** - Different handling in stepper vs edit form
5. **ProfileSetupModal no profanity** - Only validates length, not content
6. **Whitespace badges possible** - Can create badge with only spaces

---

## 3. Schedule & Sessions Domain

**Stories:** US-SCHEDULE-1 through US-SCHEDULE-12
**Files:** Schedule.jsx, SessionCard.jsx, scheduleData.js

### Story List

| ID | Title | Status |
|----|-------|--------|
| US-SCHEDULE-1 | View Schedule Grouped by Day | âœ… Validated |
| US-SCHEDULE-2 | Filter by Type | âœ… Validated |
| US-SCHEDULE-3 | Filter by Track | âœ… Validated |
| US-SCHEDULE-4 | Search by Keyword | âœ… Validated |
| US-SCHEDULE-5 | Clear Filters | âœ… Validated |
| US-SCHEDULE-6 | View Session Detail Modal | âœ… Validated |
| US-SCHEDULE-7 | See Bookmark Count | âœ… Validated |
| US-SCHEDULE-8 | Hot Popularity Badge (10+) | âœ… Validated |
| US-SCHEDULE-9 | Popular Badge (5-9) | âœ… Validated |
| US-SCHEDULE-10 | Empty Schedule State | âœ… Validated |
| US-SCHEDULE-11 | Active Filter Count Badge | âœ… Validated |
| US-SCHEDULE-12 | Toggle Filter Panel | âœ… Validated |

### Key Constants

```javascript
// Popularity thresholds
HOT_THRESHOLD = 10      // count >= 10
POPULAR_THRESHOLD = 5   // count >= 5

// Default session duration for conflict detection
DEFAULT_DURATION = 60   // minutes
```

### Issues Found

1. **Date hardcoded** - Schedule.jsx:134 hardcodes instead of using getContent()
2. **CMS violation** - Breaks protocol requiring all text through CMS

---

## 4. Bookmarking Domain

**Stories:** US-BOOKMARK-01 through US-BOOKMARK-15
**Files:** AuthContext.jsx, SessionCard.jsx, useBookmarkCounts.js, SharedSchedule.jsx

### Story List

| ID | Title | Status |
|----|-------|--------|
| US-BOOKMARK-01 | Save Session | âœ… Validated |
| US-BOOKMARK-02 | Unsave with Undo | âœ… Validated |
| US-BOOKMARK-03 | Pending User Disabled | âœ… Validated |
| US-BOOKMARK-04 | Admin Bypass | âœ… Validated |
| US-BOOKMARK-05 | Real-time Count Updates | âœ… Validated |
| US-BOOKMARK-06 | My Schedule Widget | âœ… Validated |
| US-BOOKMARK-07 | Full My Schedule Page | âœ… Validated |
| US-BOOKMARK-08 | Conflict Warning | âœ… Validated |
| US-BOOKMARK-09 | Visibility: Private | âœ… Validated |
| US-BOOKMARK-10 | Visibility: Attendees Only | âœ… Validated |
| US-BOOKMARK-11 | Visibility: Public | âœ… Validated |
| US-BOOKMARK-12 | View Shared (Public) | âœ… Validated |
| US-BOOKMARK-13 | View Shared (Attendees) | âœ… Validated |
| US-BOOKMARK-14 | Blocked from Private | âœ… Validated |
| US-BOOKMARK-15 | Download as PDF | âœ… Validated |

### Key Constants

```javascript
// Visibility options
VISIBILITY_OPTIONS = ['private', 'attendees_only', 'public']

// Registered statuses that can bookmark
BOOKMARKABLE_STATUSES = ['registered', 'confirmed', 'approved']
```

### Issues Found

1. **No visibility validation** - `updateScheduleVisibility()` accepts any string
2. **No bookmarkable feedback** - Non-bookmarkable sessions silently disabled
3. **Race condition** - Rapid clicks could cause sync issues
4. **Negative count possible** - No Firestore rule prevents count < 0

---

## 5. Admin Panel Domain

**Stories:** US-ADMIN-001 through US-ADMIN-018
**Files:** Admin.jsx, functions/index.js, firestore.rules

### Story List

| ID | Title | Status |
|----|-------|--------|
| US-ADMIN-001 | Access as Admin | âœ… Validated |
| US-ADMIN-002 | Access as Super Admin | âœ… Validated |
| US-ADMIN-003 | Access Denied for Non-Admin | âœ… Validated |
| US-ADMIN-004 | View Dashboard Stats | âœ… Validated |
| US-ADMIN-005 | Edit CMS Content | âœ… Validated |
| US-ADMIN-006 | Publish CMS Changes | âœ… Validated |
| US-ADMIN-007 | View Version History | âœ… Validated |
| US-ADMIN-008 | Create Announcement | âœ… Validated |
| US-ADMIN-009 | Toggle Announcement | âœ… Validated |
| US-ADMIN-010 | Create/Edit Updates | âœ… Validated |
| US-ADMIN-011 | Search Attendees | âœ… Validated |
| US-ADMIN-012 | Edit Attendee | âœ… Validated |
| US-ADMIN-013 | Delete Attendee | âœ… Validated |
| US-ADMIN-014 | Export CSV | âœ… Validated |
| US-ADMIN-015 | Session Analytics | âœ… Validated |
| US-ADMIN-016 | Grant Admin Role | âœ… Validated |
| US-ADMIN-017 | Revoke Admin Role | âœ… Validated |
| US-ADMIN-018 | Configure Settings | âœ… Validated |

### Permission Matrix

| Operation | Admin | Super Admin |
|-----------|-------|-------------|
| Access admin panel | âœ… | âœ… |
| Edit CMS content | âœ… | âœ… |
| Delete CMS content | âŒ | âœ… |
| Edit user profiles | âœ… | âœ… |
| Edit user role field | âŒ | âœ… |
| Grant/revoke admin | âŒ | âœ… |
| View Admins tab | âŒ | âœ… |

### Issues Found

1. **Admin list visible to all admins** - Could restrict to super_admin only

---

## 6. Eventbrite Integration Domain

**Stories:** US-EVENTBRITE-01 through US-EVENTBRITE-12
**Files:** functions/index.js, firestore.rules

### Story List

| ID | Title | Status |
|----|-------|--------|
| US-EVENTBRITE-01 | Ticket Updates Existing User | âœ… Validated |
| US-EVENTBRITE-02 | Unmatched Ticket Stored | âœ… Validated |
| US-EVENTBRITE-03 | New Account Auto-Matches | âœ… Validated |
| US-EVENTBRITE-04 | Admin Manual Sync | âœ… Validated |
| US-EVENTBRITE-05 | Refund Resets Status | âœ… Validated |
| US-EVENTBRITE-06 | Check-in Confirms | âœ… Validated |
| US-EVENTBRITE-07 | Reject Invalid Signature | ðŸ”´ BROKEN |
| US-EVENTBRITE-08 | View Sync Status | ðŸ”´ BLOCKED |
| US-EVENTBRITE-09 | See Registered Status | âœ… Validated |
| US-EVENTBRITE-10 | Unlock Bookmarking | âœ… Validated |
| US-EVENTBRITE-11 | View Unmatched List | ðŸ”´ BLOCKED |
| US-EVENTBRITE-12 | Rate Limiting | âš ï¸ Incomplete |

### Critical Issues

1. **ðŸ”´ SIGNATURE VERIFICATION BROKEN**
   - Location: functions/index.js:1337
   - Problem: Uses `JSON.stringify(req.body)` instead of `req.rawBody`
   - Impact: All webhook signature checks will fail
   - Fix: Use `req.rawBody` for HMAC comparison

2. **ðŸ”´ MISSING FIRESTORE RULES**
   - Collections: `eventbrite_synced`, `eventbrite_unmatched`
   - Impact: Admin UI cannot read these collections
   - Fix: Add admin read rules for both collections

---

## 7. Validation Learnings

### Cross-Domain Dependencies

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DEPENDENCY GRAPH                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚  ADMIN_EMAILS array must sync across 3 files:                   â”‚
â”‚  â”œâ”€â”€ AuthContext.jsx:1020-1024                                  â”‚
â”‚  â”œâ”€â”€ Dashboard.jsx:43-47                                        â”‚
â”‚  â””â”€â”€ functions/index.js:135-139                                 â”‚
â”‚                                                                  â”‚
â”‚  Profile creation chain:                                         â”‚
â”‚  loginWithGoogle() â”€â”€â–º createUserProfile() â”€â”€â–º needsProfileSetup â”‚
â”‚       â””â”€â”€ completeSignInWithEmailLink() â”€â”˜                      â”‚
â”‚                                                                  â”‚
â”‚  Bookmark permission chain:                                      â”‚
â”‚  canBookmarkSessions() checks:                                   â”‚
â”‚  â”œâ”€â”€ isAdmin() OR                                               â”‚
â”‚  â”œâ”€â”€ ADMIN_EMAILS.includes(email) OR                            â”‚
â”‚  â””â”€â”€ registrationStatus in ['registered','confirmed','approved']â”‚
â”‚                                                                  â”‚
â”‚  Eventbrite â†’ Registration chain:                                â”‚
â”‚  Webhook â”€â”€â–º Match email â”€â”€â–º Update registrationStatus          â”‚
â”‚      â””â”€â”€ Store unmatched â”€â”€â–º checkEventbriteTicket() on signup  â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Edge Cases Identified

| Domain | Edge Case | Current Handling |
|--------|-----------|------------------|
| Auth | Magic link on different device | window.prompt() - poor UX |
| Auth | Profile creation race condition | Firestore UID uniqueness prevents |
| Profile | Custom badge with only whitespace | âš ï¸ Not prevented |
| Profile | Attendance badges don't count in completion % | By design |
| Schedule | Sessions without times | Conflict detection silently skips |
| Bookmark | Rapid click handling | `saving` flag blocks, doesn't queue |
| Bookmark | Negative bookmark count | UI filters out, but DB allows |
| Admin | Concurrent CMS edits | Last write wins |
| Eventbrite | Concurrent ticket matching | âš ï¸ Race condition possible |

### Security Audit Results

| Collection | Public Read | Admin Read | Rules Status |
|------------|-------------|------------|--------------|
| users | Conditional | âœ… | âœ… Valid |
| sessionBookmarks | âœ… | âœ… | âœ… Valid |
| cmsContent | âœ… | âœ… | âœ… Valid |
| announcements | âœ… | âœ… | âœ… Valid |
| activity_logs | âŒ | âœ… | âœ… Valid |
| eventbrite_synced | âŒ | âš ï¸ | ðŸ”´ MISSING |
| eventbrite_unmatched | âŒ | âš ï¸ | ðŸ”´ MISSING |

---

## 8. Recommended Fixes

### Priority 1: Critical (Blocks Functionality)

#### Fix 1: Eventbrite Webhook Signature
```javascript
// functions/index.js:1337
// BEFORE (broken):
const payload = JSON.stringify(req.body);

// AFTER (fixed):
const payload = req.rawBody;
```

#### Fix 2: Add Eventbrite Firestore Rules
```javascript
// firestore.rules - add before default deny

match /eventbrite_synced/{docId} {
  allow read: if isAdmin() || isSuperAdmin();
  allow write: if false;  // Cloud Functions only
}

match /eventbrite_unmatched/{docId} {
  allow read: if isAdmin() || isSuperAdmin();
  allow write: if false;  // Cloud Functions only
}
```

### Priority 2: High (User Experience)

#### Fix 3: Update All Dates to June 15-16
Files to update:
- `src/components/SEO.jsx` - lines 12-13, 18, 21-22, 78, 80, 132
- `src/pages/Home.jsx` - line 240 (summitDate constant)
- `src/pages/Dashboard.jsx` - lines 1383, 1401
- `src/pages/Schedule.jsx` - line 134
- Run `npm run generate-all` after Airtable update

#### Fix 4: Redirect to Original URL After Login
```javascript
// Login.jsx - after successful login
const location = useLocation();
const from = location.state?.from?.pathname || '/dashboard';
navigate(from, { replace: true });
```

### Priority 3: Medium (Data Quality)

#### Fix 5: Preserve createdAt on Profile Completion
```javascript
// AuthContext.jsx:389-393
// Remove createdAt from the merge data
const profileData = {
  displayName: displayName.trim(),
  // createdAt: serverTimestamp(),  // REMOVE THIS LINE
  updatedAt: serverTimestamp(),
  // ...
};
```

#### Fix 6: Add Profanity Validation to Social Links
```javascript
// Dashboard.jsx - add validation to social link handlers
const handleSocialChange = (field, value) => {
  const error = validateNoProfanity(value, field);
  if (error) {
    setValidationErrors(prev => ({...prev, [field]: error}));
    return;
  }
  // ... continue with update
};
```

#### Fix 7: Prevent Whitespace-Only Custom Badges
```javascript
// Dashboard.jsx:714
// Add check for empty after trim
if (label.trim().length === 0) {
  toast.error('Badge label cannot be empty');
  return;
}
```

### Priority 4: Low (Polish)

- Validate scheduleVisibility against allowed values
- Add advisory when conflict detection unavailable (missing times)
- Consider rate limiting on sessionBookmarks updates
- Standardize toast messaging ("saved" vs "updated")

---

## Appendix: Story Count Summary

| Domain | Stories | Validated | Issues |
|--------|---------|-----------|--------|
| Authentication | 12 | 10 | 2 |
| Profile Management | 15 | 12 | 3 |
| Schedule & Sessions | 12 | 12 | 0 |
| Bookmarking | 15 | 15 | 0 |
| Admin Panel | 18 | 18 | 0 |
| Eventbrite | 12 | 8 | 4 |
| **TOTAL** | **84** | **75** | **9** |

---

*Generated by Claude Code with specialized sub-agents for exploration, story generation, and validation.*
